/*! grapesjs-preset-mautic - 1.0.346 */
!function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports["grapesjs-preset-mautic"]=t():e["grapesjs-preset-mautic"]=t()}(window,(function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,'a',t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t){e.exports=function(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function o(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}},function(e,t,o){"use strict";o.r(t);var n=o(0),i=o.n(n);function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var s=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=e.DomComponents,o=t.getType('default'),n=o.model,i=e.getConfig();i.plugins.includes('grapesjs-mjml')||i.plugins.includes('gjs-preset-newsletter')&&t.addType('dynamic-content',{model:n.extend({defaults:a({},n.prototype.defaults,{name:'Dynamic Content',draggable:'[data-gjs-type=cell]',droppable:!1,editable:!1,stylable:!1,propagate:['droppable','editable'],attributes:{'data-gjs-type':'dynamic-content','data-slot':'dynamicContent'}}),init:function(){var e=this.get('toolbar'),t='toolbar-dynamic-content';e.filter((function(e){return e.id===t})).length||e.unshift({id:t,command:'preset-mautic:dynamic-content',label:'<div class="fa fa-tag"></div>'})}},{isComponent:function(e){if(e.getAttribute&&'dynamicContent'==e.getAttribute('data-slot'))return{type:'dynamic-content'}}}),view:o.view.extend({attributes:{style:'pointer-events: all; display: table; width: 100%;user-select: none;'},events:{dblclick:'onActive'},onActive:function(){var e=this.model;this.em.get('Commands').run('preset-mautic:dynamic-content',{target:e})}})})},l=o(1),c=o.n(l),d=o(2),u=o.n(d),p=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c()(this,e),this.editor=t,this.opts=o,this.codeEditor=this.buildCodeEditor(),this.codePopup=this.buildCodePopup()}return u()(e,[{key:"buildCodeEditor",value:function(){var e=this.editor.CodeManager.getViewer('CodeMirror').clone();return e.set({codeName:'htmlmixed',readOnly:!1,theme:'hopscotch',autoBeautify:!0,autoCloseTags:!0,autoCloseBrackets:!0,lineWrapping:!0,styleActiveLine:!0,smartIndent:!0,indentWithTabs:!0}),e}},{key:"buildCodePopup",value:function(){var e=this.editor.getConfig(),t=document.createElement('div'),o=document.createElement('button'),n=document.createElement('button'),i=document.createElement('textarea');return o.innerHTML=this.opts.sourceEditBtnLabel,o.className=e.stylePrefix+'btn-prim '+e.stylePrefix+'btn-code-edit',o.onclick=this.updateCode.bind(this),n.innerHTML=this.opts.sourceCancelBtnLabel,n.className=e.stylePrefix+'btn-prim '+e.stylePrefix+'btn-code-cancel',n.onclick=this.cancelCode.bind(this),t.appendChild(i),t.appendChild(o),t.appendChild(n),this.codeEditor.init(i),t}},{key:"showCodePopup",value:function(){this.updateEditorContents(),this.codeEditor.editor.refresh(),this.editor.Modal.setContent(''),this.editor.Modal.setContent(this.codePopup),this.editor.Modal.setTitle(this.opts.sourceEditModalTitle),this.editor.Modal.open()}},{key:"updateCode",value:function(){var e=this.codeEditor.editor.getValue(),t=this.getEditorContent();try{this.editor.DomComponents.getWrapper().set('content',''),this.editor.setComponents(e.trim()),this.editor.Modal.close()}catch(e){window.alert('Template error, you should fix your code before save! \n'+e.message),this.editor.DomComponents.getWrapper().set('content',''),this.editor.setComponents(t.trim())}}},{key:"cancelCode",value:function(){this.editor.Modal.close()}},{key:"updateEditorContents",value:function(){this.codeEditor.setContent(this.getEditorContent())}},{key:"getEditorContent",value:function(){return this.editor.getConfig().plugins.includes('grapesjs-mjml')?this.editor.getHtml():this.editor.getHtml()+'<style>'+this.editor.getCss({avoidProtected:!0})+'</style>'}}]),e}(),m=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c()(this,e),this.editor=t,this.opts=o,this.codePopup=this.buildCodePopup()}return u()(e,[{key:"buildCodePopup",value:function(){var e=this.editor.getConfig(),t=document.createElement('div'),o=document.createElement('div');o.setAttribute("id","dynamic-content-popup");var n=document.createElement('button');return n.innerHTML=this.opts.dynamicContentBtnLabel,n.className=e.stylePrefix+'btn-prim '+e.stylePrefix+'btn-dynamic-content',n.onclick=this.updateCode.bind(this),t.appendChild(o),t.appendChild(n),t}},{key:"showCodePopup",value:function(e){this.updatePopupContents(e),this.editor.Modal.setContent(''),this.editor.Modal.setContent(this.codePopup),this.editor.Modal.setTitle(this.opts.dynamicContentModalTitle),this.editor.Modal.open()}},{key:"updateCode",value:function(){this.editor.Modal.close()}},{key:"updatePopupContents",value:function(e){var t=this,o=this.codePopup.querySelector('#dynamic-content-popup'),n=e.getAttributes(),i=mQuery('#emailform_dynamicContent_'+n['data-param-dec-id']);i.find('textarea.editor').each((function(){var e=t.opts.dynamicContentFroalaButtons,o={toolbarButtons:e,toolbarButtonsMD:e,toolbarButtonsSM:e,toolbarButtonsXS:e,toolbarSticky:!1,linkList:[],imageEditButtons:['imageReplace','imageAlign','imageRemove','imageAlt','imageSize','|','imageLink','linkOpen','linkEdit','linkRemove']};mQuery(this).froalaEditor('destroy'),mQuery(this).froalaEditor(mQuery.extend({},Mautic.basicFroalaOptions,o))})),i.removeClass('fade'),i.find('.tab-pane:first').find('.remove-item').hide(),mQuery(o).empty().append(i.detach())}}]),e}(),g=function(e){var t,o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.Commands;i.add('preset-mautic:code-edit',{run:function(e,o){arguments.length>2&&void 0!==arguments[2]&&arguments[2];t||(t=new p(e,n)),o&&o.set('active',0),Mautic.grapesConvertDynamicContentSlotsToTokens(e),t.showCodePopup()},stop:function(e){Mautic.grapesConvertDynamicContentTokenToSlot(e)}}),i.add('preset-mautic:dynamic-content',{run:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.target,a=r||e.getSelected();o||(o=new m(e,n)),o.showCodePopup(a),Mautic.grapesConvertDynamicContentSlotsToTokens(e)},stop:function(e){Mautic.grapesConvertDynamicContentTokenToSlot(e)}})},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.$,n=e.Panels;if(t.sourceEdit&&n.addButton('options',[{id:'code-edit',className:'fa fa-edit',command:'preset-mautic:code-edit',attributes:{title:t.sourceEditModalTitle}}]),!t.showImportButton){var i=n.getButton('options','mjml-import'),r=n.getButton('options','gjs-open-import-template'),a=n.getButton('options','gjs-open-import-webpage');null!==i&&n.removeButton('options','mjml-import'),null!==r&&n.removeButton('options','gjs-open-import-template'),null!==a&&n.removeButton('options','gjs-open-import-webpage')}var s=n.getButton('options','undo'),l=n.getButton('options','redo');null!==s&&(n.removeButton('options','undo'),n.addButton('commands',[{id:'undo',className:'fa fa-undo',attributes:{title:'Undo'},command:function(){e.runCommand('core:undo')}}])),null!==l&&(n.removeButton('options','redo'),n.addButton('commands',[{id:'redo',className:'fa fa-repeat',attributes:{title:'Redo'},command:function(){e.runCommand('core:redo')}}]));var c=n.getButton('options','preview');null!==c&&n.removeButton('options','preview');var d=n.getButton('options','canvas-clear');null!==d&&n.removeButton('options','canvas-clear');var u=n.getButton('options','gjs-toggle-images');null!==u&&n.removeButton('options','gjs-toggle-images'),e.on('load',(function(){if(!t.showLayersManager){var i=n.getButton('views','open-layers');null!==i&&i.set('attributes',{style:'display:none;'})}var r=n.getButton('options','sw-visibility');r&&r.set('active',1);var a=n.getButton('views','open-tm');a&&a.set('active',1);var s=n.getButton('views','open-sm');s&&s.set('active',1),n.removeButton("views","open-tm");var l=o("<div class=\"gjs-sm-sector no-select\"><div class=\"gjs-sm-title\"><span class=\"icon-settings fa fa-cog\"></span> Settings</div><div class=\"gjs-sm-properties\" style=\"display: none;\"></div></div>"),c=l.find('.gjs-sm-properties');c.append(o('.gjs-trt-traits')),o('.gjs-sm-sectors').before(l),l.find('.gjs-sm-title').on('click',(function(){var e=c.get(0).style,t='none'===e.display;e.display=t?'block':'none'})),c.get(0).style.display='block';var d=e.Panels.getButton('views','open-blocks');d&&d.set('active',1)}))},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.BlockManager,n=e.getConfig(),i=o.getAll();n.plugins.includes('grapesjs-mjml')||n.plugins.includes('gjs-preset-newsletter')&&o.add('dynamic-content',{label:t.dynamicContentBlockLabel,activate:!0,select:!0,attributes:{class:'fa fa-tag'},content:{type:'dynamic-content',content:'{dynamiccontent="Dynamic Content"}',style:{padding:'10px'},activeOnRender:1}}),void 0!==o.get('mj-hero')&&o.get('mj-hero').set({attributes:{class:'gjs-fonts gjs-f-hero'}}),void 0!==o.get('mj-wrapper')&&o.remove('mj-wrapper'),i.forEach((function(e){e.set({category:t.categoryBlockLabel})})),void 0!==o.get('mj-1-column')&&o.get('mj-1-column').set({category:t.categorySectionLabel}),void 0!==o.get('mj-2-columns')&&o.get('mj-2-columns').set({category:t.categorySectionLabel}),void 0!==o.get('mj-3-columns')&&o.get('mj-3-columns').set({category:t.categorySectionLabel}),void 0!==o.get('sect100')&&o.get('sect100').set({category:t.categorySectionLabel}),void 0!==o.get('sect50')&&o.get('sect50').set({category:t.categorySectionLabel}),void 0!==o.get('sect30')&&o.get('sect30').set({category:t.categorySectionLabel}),void 0!==o.get('sect37')&&o.get('sect37').set({category:t.categorySectionLabel}),void 0!==o.get('column1')&&o.get('column1').set({category:t.categorySectionLabel}),void 0!==o.get('column2')&&o.get('column2').set({category:t.categorySectionLabel}),void 0!==o.get('column3')&&o.get('column3').set({category:t.categorySectionLabel}),void 0!==o.get('column3-7')&&o.get('column3-7').set({category:t.categorySectionLabel})};function b(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?b(Object(o),!0).forEach((function(t){i()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):b(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=mQuery,n=e.AssetManager,i=v({sourceEdit:1,sourceEditBtnLabel:'Edit',sourceCancelBtnLabel:'Cancel',sourceEditModalTitle:'Edit code',deleteAssetConfirmText:'Are you sure?',showLayersManager:0,showImportButton:0,replaceRteWithFroala:!0,categorySectionLabel:'Sections',categoryBlockLabel:'Blocks',dynamicContentBlockLabel:'Dynamic Content',dynamicContentBtnLabel:'Save',dynamicContentModalTitle:'Edit Dynamic Content',dynamicContentFroalaButtons:['undo','redo','|','bold','italic','underline','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','token','insertLink','insertImage','html']},t);if(n.addType('image',{view:{onRemove:function(e){e.stopImmediatePropagation();var t=this.model;confirm(i.deleteAssetConfirmText)&&t.collection.remove(t)}}}),i.replaceRteWithFroala&&void 0!==o.FroalaEditor){var r=e.RichTextEditor.getToolbarEl();[].forEach.call(r.children,(function(e){e.style.display='none'})),e.setCustomRte({enable:function(t,n){return n=o(t).froalaEditor({enter:o.FroalaEditor.ENTER_BR,pastePlain:!0,htmlAllowedTags:['a','abbr','address','area','article','aside','audio','b','base','bdi','bdo','blockquote','br','button','canvas','caption','cite','code','col','colgroup','datalist','dd','del','details','dfn','dialog','div','dl','dt','em','embed','fieldset','figcaption','figure','footer','form','h1','h2','h3','h4','h5','h6','header','hgroup','hr','i','iframe','img','input','ins','kbd','keygen','label','legend','li','link','main','map','mark','menu','menuitem','meter','nav','noscript','object','ol','optgroup','option','output','p','param','pre','progress','queue','rp','rt','ruby','s','samp','script','style','section','select','small','source','span','strike','strong','sub','summary','sup','table','tbody','td','textarea','tfoot','th','thead','time','title','tr','track','u','ul','var','video','wbr','center'],htmlAllowedAttrs:['data-atwho-at-query','data-section','data-section-wrapper','accept','accept-charset','accesskey','action','align','allowfullscreen','alt','async','autocomplete','autofocus','autoplay','autosave','background','bgcolor','border','charset','cellpadding','cellspacing','checked','cite','class','color','cols','colspan','content','contenteditable','contextmenu','controls','coords','data','data-.*','datetime','default','defer','dir','dirname','disabled','download','draggable','dropzone','enctype','for','form','formaction','frameborder','headers','height','hidden','high','href','hreflang','http-equiv','icon','id','ismap','itemprop','keytype','kind','label','lang','language','list','loop','low','max','maxlength','media','method','min','mozallowfullscreen','multiple','name','novalidate','open','optimum','pattern','ping','placeholder','poster','preload','pubdate','radiogroup','readonly','rel','required','reversed','rows','rowspan','sandbox','scope','scoped','scrolling','seamless','selected','shape','size','sizes','span','src','srcdoc','srclang','srcset','start','step','summary','spellcheck','style','tabindex','target','title','type','translate','usemap','value','valign','webkitallowfullscreen','width','wrap'],toolbarButtons:['bold','italic','underline','strikeThrough','quote','clearFormatting','-','formatOL','formatUL','indent','outdent','token','insertLink'],toolbarContainer:e.RichTextEditor.getToolbarEl(),linkEditButtons:['linkOpen','linkRemove']}),o(t).on('froalaEditor.popups.show.link.edit',(function(e,n){var i=o(t).froalaEditor('link.get'),r=o(t).froalaEditor('popups.get','link.edit');if(void 0!==i){var a=i.getBoundingClientRect().top,s=o(i).outerHeight();r.css('top',parseInt(a)+parseInt(s)+35)}})),n},disable:function(e,t){o(e).off('froalaEditor.popups.show.link.edit'),o(e).froalaEditor('destroy')}})}s(e,i),g(e,i),f(e,i),y(e,i)}}])}));
//# sourceMappingURL=grapesjs-preset-mautic.min.js.map